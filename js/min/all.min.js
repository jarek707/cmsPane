// GLOBAL Utility START
function SER(e){return JSON.stringify(e)}function LG(){window.console&&console.log(arguments)}function LGE(){if(window.console)for(var e=0;e<arguments.length;e++)console.log(arguments[e])}function LGS(){window.console&&console.log(JSON.stringify(arguments))}function LGT(){var e=_.map(arguments,function(e,t){return e});setTimeout(function(){window.console&&console.log(e)},e.pop())}function TM(e){var t=(new Date).getTime();console.log(t-TMIN+" : TIMER FOR "+e)}function SER(e){return JSON.stringify(e)}function LG(){window.console&&console.log(arguments)}function LGW(){window.console&&(_.isFunction(window.console.warn)?console.info(arguments[0]):console.log(arguments))}function LGE(){if(window.console)for(var e=0;e<arguments.length;e++)console.log(arguments[e])}function LGS(){window.console&&console.log(JSON.stringify(arguments))}function LGT(){var e=_.map(arguments,function(e,t){return e});setTimeout(function(){window.console&&console.log(e)},e.pop())}function contentPane(e,t){e.saved=!1,e.clearLocalStorage=function(){t.clear(),document.location=document.location},e.dumpLocalStorage=function(){var t=angular.copy(_(localStorage).omit("FirebugLite"));$.post("data/postLocStorage.php",{data:JSON.stringify(t)}).success(function(t){e.saved=!0,e.$digest(),setTimeout(function(){e.saved=!1,e.$digest()},2e3)})},e.restoreLocalStorage=function(){var e=angular.copy(_(localStorage).omit("FirebugLite"));$.get("data/getLocStorage.php").success(function(e){var t=JSON.parse(e);_(t).each(function(e,t){localStorage[t]=e,document.location=document.location})})}}function leftPane(){}function rightPane(e){}UT={wait:function(e,t,n){function r(){return--cnt&&(_.isUndefined(e[t])||_.isEmpty(e[t]))?setTimeout(function(){r(e,t,r)},50):setTimeout(function(){n(cnt)},100)}return cnt=60,r()},minIntKey:function(e,t){_.isUndefined(t)&&(t=0);if(_.isEmpty(e))return parseInt(t);var n=_.min(_(_.keys(e)).map(function(e){return parseInt(e)}));return(n>0?0:n)+parseInt(t)},mkEmpty:function(e,t){return _.map(e,function(e){return _.isUndefined(t)?"":t})},camelize:function(e,t){var n=e.charAt(0),r=UT.join(_(e.split("_")).map(function(e,t){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()}),"");return t?r:n+r.substr(1)},camelDash:function(e){var t=e.split("-"),n=t[0];for(var r=1;r<t.length;r++)n+=t[r].charAt(0).toUpperCase()+t[r].substr(1);return n},doubleCopy:function(e,t){return _(t).isObject()&&angular.copy(e,t),angular.copy(e)},gridKey:function(e){return e.replace(/-*\d+\//g,"")},join:function(e,t){typeof t=="undefined"&&(t=", ");var n="";for(var r=0;r<e.length;r++)typeof e[r]!="undefined"&&!_.isEmpty(e[r])&&e[r]!==null&&(n+=t+e[r]);return n.substr(t.length)}},Function.prototype.method=function(e,t){return this.prototype[e]=t,this},Function.method("inherits",function(e){this.prototype=new e;var t={},n=this.prototype;return this.prototype.constructor=e,this.method("uber",function(i){i in t||(t[i]=0);var s,o,u=t[i],a=e.prototype;if(u){while(u)a=a.constructor.prototype,u-=1;s=a[i]}else s=n[i],s==this[i]&&(s=a[i]);return t[i]+=1,o=s.apply(this,Array.prototype.slice.apply(arguments,[1])),t[i]-=1,o}),this}),Function.method("swiss",function(e){for(var t=1;t<arguments.length;t+=1){var n=arguments[t];this.prototype[n]=e.prototype[n]}return this}),PaneConfig={stylists:{cols:[["name","Stylist's Name"],["image_url","Image Url"],["address","Address"],["phone","Phone"],["email","Email"]]},salons:{cols:[["left","Salon Name"],["right","Image Url"]]},clients:{cols:[["left","Name"],["right","Image Url"]]},users:{cols:[["left","First Name"],["right","Last Name"]]}},angular.module("app.gridConf",["app.directives"]).service("config",["$http",function($http){var selects={};return $http.get("data/selects").success(function(e){selects=e}),{setParams:function(e){function t(t,r){_.isUndefined(e[t])||_.isEmpty(e[t])?_.isUndefined(n[t])&&(n[t]=r):n[t]=e[t]}this.setConfigObject(_.isUndefined(e.PaneConfig)?"PaneConfig":e.PaneConfig);var n=_(this.getMeta(e.key)).extend(e);return t("paneConfig","PaneConfig"),t("tplDir","partials"),t("pane","cmsMain"),t("relContainer",!1),t("rel",""),t("relKey",""),t("key",!1),t("jqueryUi",!1),n.autoClose=n["auto-close"]||!_.isUndefined(e["auto-close"]),n},getAllTemplates:function(e,t,n){var r=["cmsPane","cmsCheckbox","cmsFooter","cmsPane","cmsRadio","cmsSelect","cmsText","pImg","buttons"];e.templates={};var i=_.isEmpty(t)?r:_.union(r,t),s=function(t,r){var i=t.shift();$http.get(e.meta.tplDir+"/"+i+".html").success(function(e){r[i]=e,t.length?s(t,r):n()})};s(i,e.templates)},setConfigObject:function(configObjectName){try{var configObject=eval(configObjectName)}catch(err){return!1}return this.configObject=configObject},findMeta:function(e){var t=UT.gridKey(e).split("/"),n=angular.copy(this.configObject[t.shift()]);for(var r=0;r<t.length;r++)n=n.children[t[r]];return _.isUndefined(n)?{}:n},getMeta:function(e){return this.findMeta(e)},getAllColumns:function(e){var t=[],n=[],r=[],i={},s=0,o=0,u={};return _(e.columns).each(function(e,a){r=e.split(":"),i={};if(_.isUndefined(r[1])||r[1].substr(0,1)!="-"){switch(r.length){case 4:i.labs=r[3].split(",");case 3:i.type=r[2];case 2:i.pos=r[1];case 1:i.name=r[0];break;default:i={}}_.isUndefined(i.type)&&(i.type="T"),i.type=="S"&&!_.isUndefined(selects[i.labs])&&(i.labs=selects[i.labs]),_.isUndefined(i.pos)?(u[a]=o,s=100+o++):(s=parseInt(isNaN(i.pos.substr(0,1))?i.pos.substr(1):i.pos)+200,u[a]=s-200);if(_.isUndefined(i.pos)||i.pos.substr(0,1)!="+")i.pos=a.toString(),n.push(_.clone(i));i.pos=a.toString(),t[s]=angular.copy(i)}}),{tab:n,all:_(t).filter(function(){return!0})}},getTabColumns:function(e){var t=[],n=[];return _(e.columns).each(function(e,r){n=e.split(":"),(_.isUndefined(n[1])||n[1].substr(0,1)!="-"&&n[1].substr(0,1)!="+")&&t.push(n[0])}),t},getChildren:function(e){return _.isUndefined(m=this.findMeta(e))?!1:m.children}}}]),angular.module("app.services",["app.gridConf"]).factory("dom",["$compile","$http",function(e,t){return{pushRelToIterate:function(e,t){$(e).find(">div[iterate]").attr("rel",t)},setupButtons:function(e,t){if(!_.isUndefined(t.use)){var n=e.find("input"),r=t.use.split(",");for(var i=0;i<n.length;i++)_(r).contains(n[i].className.replace("Button",""))||angular.element(n[i]).remove();e.data().html=e.html()}},getTpl:function(n,r,i){t.get("partials/"+r+".html").success(function(t){i(e(t)(n))})},attrsToMeta:function(e){return $ret={},_(e).each(function(e,t){if(_.isString(e))try{$ret[t]=_(["[","{"]).contains(e.substr(0,1))?JSON.parse(e):e}catch(n){}}),$ret},compileChildPane:function(t,n){var r=_.clone(n.data().meta),i=angular.element(n.data().outer);i.data().meta=r,i=e(i)(t),n.replaceWith(i)},convertChild:function(e){var t={},n=e.get()[0];for(var r=0;r<n.attributes.length;r++){var i=n.attributes[r].nodeName,s=n.attributes[r].nodeValue;i!=="class"&&i.indexOf("-")>-1&&(i=UT.camelDash(i));try{t[i]=_(["[","{"]).contains(s.substr(0,1))?JSON.parse(s):s}catch(o){}}e.data().outer='<div cms-pane row-id="{{rowId}}" parent-id="{{id}}"  parent-list="list" exposer="exposing(data)" key="'+t.key+'" rel="'+t.rel+'">'+n.innerHTML+"</div>",e.data().meta=t,n.innerHTML="";return},paramTransclude:function(e,t){var n=_.isUndefined(e.data().meta)?{}:e.data().meta;return n.children=e.get()[0].innerHTML,e.html(""),_.extend(n,this.attrsToMeta(t))},makeMain:function(t){$scope=t.data().$scope,t.append(e($scope.meta.children)($scope))}}}]).factory("jquery_ui",["$http","config",function(e,t){return{init:function(e,t){var n=e.data().meta;_.isUndefined(n.jqSortable)||this.sortable(e,t.sortable,n.jqSortable)},sortable:function(e,t,n){var r={tolerance:"pointer",helper:"clone",cursor:"move",distance:1,cursorAt:{left:5},update:function(e,n){sort=$(this).sortable("toArray",{attribute:"row-id"}),_.isFunction(t)&&t(e,n,sort)}};_.isEmpty(n)||(r=_.extend(r,{connectWith:'[key="'+n+'"] .dataContent'})),$(e).find(".sortable").sortable(r)}}}]).factory("lData",["$http","config",function(e,t){return{prefix:"GRID:",useLocal:document.location.host==="cms",clear:function(){var e="";for(var t in localStorage)t.substr(0,5)==this.prefix&&(e+=t.substr(5)+"\n");var n=prompt("Enter key from the list:\n\n"+e);_.isEmpty(n)?localStorage.clear():delete localStorage[this.prefix+n]},save:function(e,t,n,r){if(_.isUndefined(r)||!r)e=UT.gridKey(e);var i=e.replace("/","_"),s=i.indexOf("_")>-1?"&rel":"",o=_.isUndefined(t[n])?"del":"post";return $.post("data/db.php?action="+o+"&table="+i+s+"&rowId="+n,t[n]).success(function(e){}),"success"},get:function(e,t){t.listW=angular.copy(t.list=this.getData(e.key))},getData:function(t,n,r){var s=t.replace("/","_"),o=s.indexOf("_")>-1?"&rel":"",r=_.isUndefined(r)?"":"&pid="+r;e.get("data/db.php?action=get&table="+s+o+r).success(function(e){_.isEmpty(e)&&(e={}),n(e)}).error(function(e){LGE("GET DATA ERROR FOR "+e,t)})}}}]),angular.module("app.customDirectives",["app.gridConf"]).directive("details",["$compile","lData","config",function(t,n,r){return{restrict:"A",replace:!0,transclude:!0,templateUrl:r.tplUrls.sub,scope:!0,compile:function(e,t){return function(e,t,n){e.detailShow=!0,e.getType=function(t){return e.meta.all[t].type}}},controller:function(e,t){e.metaType="all",e.sav=function(){e.close(),e.$parent.sav()},e.close=function(){t.remove(),e.$parent.$parent.tableHide=!1}}}}]).directive("cmsUser",["config",function(e){return{restrict:"A",replace:!0,transclude:!0,templateUrl:"partials/cmsUser.html"}}]).directive("divImg",["config",function(e){return{restrict:"A",replace:!0,transclude:!0,templateUrl:"partials/divImg.html"}}]).directive("cmsCaption",["config",function(e){return{restrict:"A",replace:!0,transclude:!0,template:"<div ng-click='clk()'>{{row[meta.cols[0][0]]}}:{{row[meta.cols[1][0]]}}</div>"}}]).directive("cmsImg",["config",function(e){return{restrict:"A",replace:!0,transclude:!0,template:"<div ng-click='clk()'><img ng-src='{{row[meta.cols[1][0]]}}' width=20 height=20></img></div>"}}]).directive("aCaption",["config",function(e){return{restrict:"A",replace:!0,transclude:!0,template:"<div ng-click='clk()'>{{row[meta.cols[0][0]]}}:{{row[meta.cols[1][0]]}}></div>"}}]),angular.module("app.relationScopes",[]).service("relScopes",["lData","jquery_ui",function(e,t){return{oneToMany:{link:{main:function(e){_.defer(e.dataInit)},row:function(e){_.isUndefined(e.meta.selected)||UT.wait(e,"id",function(){_.isEmpty(e.meta.selected)?e.id===_.keys(e.list)[0]&&(e.clk(),e.$parent.$digest()):e.list[e.id][e.meta.cols[0][0]]===e.meta.selected&&(e.clk(),e.$parent.$digest())})}},controller:{row:function(e){var t=e.clk;e.clk=function(){e.$parent.rowId=e.id,e.attachAfterRow(),t()}}}},manyToOne:{link:{main:function(e){e.saveRelData=function(){},e.dataInit=function(){e.loadData(e.rowId)},e.$watch("rowId",function(){_.isEmpty(e.rowId)||e.dataInit()})}},controller:{main:function(e){var t=e.save;e.save=function(n,r){n.pid=e.rowId,t(n,r)}},row:function(e){var t=e.clk;e.clk=function(){e.$parent.id=e.id,t()}}}},manyToOneOut:{link:{main:function(e){e.loadData=function(){},e.updateRefList=function(){!_.isEmpty(e.rowId)&&!_.isUndefined(e.parentList)&&(e.list={},e.list[e.parentId]=e.parentList[e.parentId])},e.$watch("parentId",e.updateRefList)}},controller:{}},oneToSelect:{link:{main:function(n,r){n.saveRelData=function(){_.isEmpty(n.relData[n.rowId])&&(n.relData[n.rowId]={}),e.save(n.relDataKey,n.relData,n.rowId)},n.listFilter=function(e){return _.isUndefined(n.relData)||_.isEmpty(n.rowId)?e:_.isUndefined(n.relData[n.rowId])?e:_(e).omit(_(n.relData[n.rowId]).keys())},n.relDataKey=n.expose("meta").key+"/"+n.meta.key,e.getData(n.relDataKey,function(e){n.relData=_.isEmpty(e)?{}:e}),n.dataInit(),UT.wait(n,"list",function(){t.init(r,{sortable:n.handleSort})})},row:function(e){e.buttonsOnOff("edit,del,add,out","save,sub,close"),e.$watch("id",function(){e.$parent.id=e.id})}},controller:{main:function(e,t){var n=e.save;e.save=function(e,t){n(e,t)},e.remove=function(t){delete e.relData[e.rowId][t],e.saveRelData()}},row:function(e,t){function n(){if(e.rowClass.indexOf("editable")===-1){if(!_.contains(e.relData[e.rowId],e.id)){var t=e.relData[e.rowId];_.isUndefined(t)&&(e.relData[e.rowId]=t={});var n=0;for(var r in t)t[r].ord>=n&&(n=parseInt(t[r].ord)+1);_.isUndefined(t[e.id])&&(e.relData[e.rowId][e.id]={ord:n})}e.saveRelData(),e.$parent.$broadcast("relDataChanged")}}function r(){if(e.relData)for(var t in e.relData)_.has(e.relData[t],e.id)||(e.relData[t]=_(e.relData[t]).omit(e.id))}e.dblClk=function(){n()},e.out=function(){n()};var i=e.del;e.del=function(){r(),e.saveRelData(),e.$parent.$broadcast("relDataChanged"),i()};var s=e.save;e.save=function(){r(),s(),e.$parent.$broadcast("relDataChanged")},e.clk=function(){var t=angular.element("detail").show().data().$scope;t.url=e.workRow.right,t.caption=e.workRow.left}}}},oneToSelectOut:{link:{main:function(e,n){e.updateRefList=function(){e.list={};if(!_.isEmpty(e.rowId)){var t=e.expose("relData")[e.rowId];if(!_.isUndefined(t)&&!_.isEmpty(t)){var n={};for(var r in t)n[t[r].ord]=e.parentList[r],_.isUndefined(n[t[r].ord])?delete t[r]:n[t[r].ord].id=r;_.defer(function(){e.list=n,e.$digest()})}else t={}}return e},e.loadData=function(){},e.$on("relDataChanged",e.updateRefList),e.$watch("rowId",e.updateRefList),e.handleSort=function(t,n,r){var i=e.expose("relData");_.isUndefined(i[e.rowId])&&(i[e.rowId]={});var s=i[e.rowId];for(var o=0;o<r.length;o++)_.isUndefined(s[r[o]])&&(s[r[o]]={}),s[r[o]].ord=o;e.updateRefList().expose("saveRelData")()},UT.wait(e,"list",function(){t.init(n,{sortable:e.handleSort}),TM(e.meta.key)})},row:function(e,t){e.buttonsOnOff("remove","")}},controller:{row:function(e,t){e.remove=function(){e.expose("remove")(e.list[e.id].id),e.updateRefList()},e.clk=function(){var t=angular.element("detail").show().data().$scope;t.show({url:e.workRow.right,caption:e.workRow.left})}}}},"null":{link:{main:function(e,t){},row:function(e,t){}},controller:{main:function(e,t){},row:function(e,t){}}}}}]),angular.module("app.scopes",["app.relationScopes"]).service("linkers",["lData","relScopes",function(e,t){return{set:function(e,n,r){this[e](n,r);var i=t[n.meta.rel];!_.isUndefined(i)&&_.isFunction(i.link[e])&&i.link[e](n,r)},main:function(t,n){t.sortable=_.isUndefined(t.meta.jqSortable)?!1:"sortable",t.expose=function(e){return t.exposer({data:e})},t.lastRowScope=null,t.setList=function(){t.list=angular.copy(t.listW)},t.getData=function(e){t.listW=angular.copy(e),t.setList()},t.loadData=function(n){_.defer(function(){_.isUndefined(t.meta.key)||e.getData(t.meta.key,t.getData,n)})},t.dataInit=function(){t.loadData()},t.handleSort=function(){LGW("Presistent sorting not implemented for this relation")}},row:function(e,t){e.rowClass="",e.buttons={},e.buttonsOnOff=function(t,n){_(t.split(",")).each(function(t,n){e.buttons[t]=!0}),_(n.split(",")).each(function(t,n){e.buttons[t]=!1})},e.buttonsOnOff("edit,del","add,save,sub,close"),e.attachAfterRow=function(){t.parent().after(e.meta.element.find("inline").detach())},e.rowEmpty=function(){var t=!1;if(!_.isUndefined(e.row))for(var n=0;n<e.meta.cols.length;n++)t|=e.row[e.meta.cols[n][0]]!=="";return!t},e.rowEmpty()&&(e.rowClass="editable",e.buttonsOnOff("close","edit")),e.workRow=angular.copy(e.row)}}}]).service("controllers",["lData","relScopes",function(e,t){"use strict";return{set:function(e,n,r){this[e](n);var i=t[n.meta.rel];!_.isUndefined(i)&&_.isFunction(i.controller[e])&&i.controller[e](n,r)},head:function(e){e.loadButton=!1,e.toggleContent=function(){e.hideContent=e.hideContent?!1:"hidden"},e.reload=function(){e.list=UT.dobuleCopy(e.list,e.listW),e.notify("rel","success",_.isEmpty(e.list)?" (empty)":""),e.hideContent&&e.toggleTable()}},main:function(t){t.closeLastRow=function(e){var n=!0;return t.lastRowScope===!1?n=!1:t.lastRowScope!==null&&(t.lastRowScope.$id!==e.$id?t.lastRowScope.blr():n=!1),t.lastRowScope=e,n},t.save=function(n,r){t.list[r]=_.clone(n);var i=e.save(t.meta.key,t.list,r);_.isFunction(t.notify)&&t.notify("sav",i),t.meta.autoAdd&&t.add()},t.del=function(n){var r=_(t.list[n]).values().pop();delete t.list[n];var i=e.save(t.meta.key,t.list,n);_.isFunction(t.notify)&&t.notify("del",i,' <b>"'+r+'"</b>')},t.add=function(){var e=UT.minIntKey(t.list,-1);t.list[e]={},t.listW[e]={};for(var n=0;n<t.meta.cols.length;n++)t.list[e][t.meta.cols[n][0]]="",t.listW[e][t.meta.cols[n][0]]="";t.closeLastRow(!1),t.hideContent=!1}},row:function(e){function t(){return e.buttons.save=e.dirty=!_(e.row).isEqual(e.workRow)}function n(){return UT.join(_(e.workRow).filter(function(t,n){if(!_.isUndefined(e.meta.tab[n]))return e.meta.tab[n].type==="T"?t:!1}))}e.chg=function(){e.rowClass="editable"+(t()?" dirty":"")},e.sel=function(){e.rowClass="selected"+(t()?" dirty":"")},e.blr=function(){e.rowClass?e.rowClass=e.rowClass.replace("editable","").replace("selected",""):e.rowClass="",e.buttonsOnOff("edit","save,close")},e.editRow=function(){e.closeLastRow(e),e.chg()},e.clk=function(t,n){e.closeLastRow(e)&&e.sel()},e.save=function(){e.$parent.save(e.workRow,e.id),e.rowClass="",e.buttonsOnOff("edit","close,save")},e.del=function(){e.$parent.del(e.id)},e.subPane=function(){e.$parent.subPane(e,n())},e.edit=function(){e.chg(),e.closeLastRow(e),e.buttonsOnOff("close","edit")},e.close=function(){e.rowEmpty()?e.$parent.list=_(e.list).omit(e.id):e.workRow=_.clone(e.row),e.blr()}}}}]);var TMIN=(new Date).getTime(),myApp=angular.module("app",["app.services","app.directives","app.customDirectives"]);contentPane.$inject=["$scope","lData"],myApp.controller("contentPane",contentPane);