// GLOBAL Utility START
function SER(e){return JSON.stringify(e)}function LG(){window.console&&console.log(arguments)}function LGE(){if(window.console)for(var e=0;e<arguments.length;e++)console.log(arguments[e])}function LGS(){window.console&&console.log(JSON.stringify(arguments))}function LGT(){var e=_.map(arguments,function(e,t){return e});setTimeout(function(){window.console&&console.log(e)},e.pop())}function SER(e){return JSON.stringify(e)}function LG(){window.console&&console.log(arguments)}function LGW(){window.console&&(_.isFunction(window.console.warn)?console.info(arguments[0]):console.log(arguments))}function LGE(){if(window.console)for(var e=0;e<arguments.length;e++)console.log(arguments[e])}function LGS(){window.console&&console.log(JSON.stringify(arguments))}function LGT(){var e=_.map(arguments,function(e,t){return e});setTimeout(function(){window.console&&console.log(e)},e.pop())}function contentPane(e,t){e.saved=!1,e.clearLocalStorage=function(){t.clear(),document.location=document.location},e.dumpLocalStorage=function(){var t=angular.copy(_(localStorage).omit("FirebugLite"));$.post("data/postLocStorage.php",{data:JSON.stringify(t)}).success(function(t){e.saved=!0,e.$digest(),setTimeout(function(){e.saved=!1,e.$digest()},2e3)})},e.restoreLocalStorage=function(){var e=angular.copy(_(localStorage).omit("FirebugLite"));$.get("data/getLocStorage.php").success(function(e){var t=JSON.parse(e);_(t).each(function(e,t){localStorage[t]=e,document.location=document.location})})}}function leftPane(){}function rightPane(e){}UT={minIntKey:function(e,t){_.isUndefined(t)&&(t=0);if(_.isEmpty(e))return parseInt(t);var n=_.min(_(_.keys(e)).map(function(e){return parseInt(e)}));return(n>0?0:n)+parseInt(t)},mkEmpty:function(e,t){return _.map(e,function(e){return _.isUndefined(t)?"":t})},camelize:function(e,t){var n=e.charAt(0),r=UT.join(_(e.split("_")).map(function(e,t){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()}),"");return t?r:n+r.substr(1)},camelDash:function(e){var t=e.split("-"),n=t[0];for(var r=1;r<t.length;r++)n+=t[r].charAt(0).toUpperCase()+t[r].substr(1);return n},doubleCopy:function(e,t){return _(t).isObject()&&angular.copy(e,t),angular.copy(e)},gridKey:function(e){return e.replace(/-*\d+\//g,"")},join:function(e,t){typeof t=="undefined"&&(t=", ");var n="";for(var r=0;r<e.length;r++)typeof e[r]!="undefined"&&!_.isEmpty(e[r])&&e[r]!==null&&(n+=t+e[r]);return n.substr(t.length)}},Function.prototype.method=function(e,t){return this.prototype[e]=t,this},Function.method("inherits",function(e){this.prototype=new e;var t={},n=this.prototype;return this.prototype.constructor=e,this.method("uber",function(i){i in t||(t[i]=0);var s,o,u=t[i],a=e.prototype;if(u){while(u)a=a.constructor.prototype,u-=1;s=a[i]}else s=n[i],s==this[i]&&(s=a[i]);return t[i]+=1,o=s.apply(this,Array.prototype.slice.apply(arguments,[1])),t[i]-=1,o}),this}),Function.method("swiss",function(e){for(var t=1;t<arguments.length;t+=1){var n=arguments[t];this.prototype[n]=e.prototype[n]}return this}),PaneConfig={stylists:{cols:[["name","Stylist's Name"],["image_url","Image Url"],["address","Address"],["phone","Phone"],["email","Email"]]},salons:{cols:[["left","Salon Name"],["right","Image Url"]]},clients:{cols:[["left","Name"],["right","Image Url"]]},users:{cols:[["left","First Name"],["right","Last Name"]]}},angular.module("app.gridConf",["app.directives"]).service("config",["$http",function($http){var selects={};return $http.get("data/selects").success(function(e){selects=e}),{setParams:function(e){function t(t,r){_.isUndefined(e[t])||_.isEmpty(e[t])?_.isUndefined(n[t])&&(n[t]=r):n[t]=e[t]}this.setConfigObject(_.isUndefined(e.PaneConfig)?"PaneConfig":e.PaneConfig);var n=_(this.getMeta(e.key)).extend(e);return t("paneConfig","PaneConfig"),t("tplDir","partials"),t("pane","cmsMain"),t("relContainer",!1),t("rel",""),t("relKey",""),t("key",!1),t("jqueryUi",!1),n.autoClose=n["auto-close"]||!_.isUndefined(e["auto-close"]),n},getAllTemplates:function(e,t,n){var r=["cmsPane","cmsCheckbox","cmsFooter","cmsPane","cmsRadio","cmsSelect","cmsText","pImg","buttons"];e.templates={};var i=_.isEmpty(t)?r:_.union(r,t),s=function(t,r){var i=t.shift();$http.get(e.meta.tplDir+"/"+i+".html").success(function(e){r[i]=e,t.length?s(t,r):n()})};s(i,e.templates)},setConfigObject:function(configObjectName){try{var configObject=eval(configObjectName)}catch(err){return!1}return this.configObject=configObject},findMeta:function(e){var t=UT.gridKey(e).split("/"),n=angular.copy(this.configObject[t.shift()]);for(var r=0;r<t.length;r++)n=n.children[t[r]];return _.isUndefined(n)?{}:n},getMeta:function(e){return this.findMeta(e)},getAllColumns:function(e){var t=[],n=[],r=[],i={},s=0,o=0,u={};return _(e.columns).each(function(e,a){r=e.split(":"),i={};if(_.isUndefined(r[1])||r[1].substr(0,1)!="-"){switch(r.length){case 4:i.labs=r[3].split(",");case 3:i.type=r[2];case 2:i.pos=r[1];case 1:i.name=r[0];break;default:i={}}_.isUndefined(i.type)&&(i.type="T"),i.type=="S"&&!_.isUndefined(selects[i.labs])&&(i.labs=selects[i.labs]),_.isUndefined(i.pos)?(u[a]=o,s=100+o++):(s=parseInt(isNaN(i.pos.substr(0,1))?i.pos.substr(1):i.pos)+200,u[a]=s-200);if(_.isUndefined(i.pos)||i.pos.substr(0,1)!="+")i.pos=a.toString(),n.push(_.clone(i));i.pos=a.toString(),t[s]=angular.copy(i)}}),{tab:n,all:_(t).filter(function(){return!0})}},getTabColumns:function(e){var t=[],n=[];return _(e.columns).each(function(e,r){n=e.split(":"),(_.isUndefined(n[1])||n[1].substr(0,1)!="-"&&n[1].substr(0,1)!="+")&&t.push(n[0])}),t},getChildren:function(e){return _.isUndefined(m=this.findMeta(e))?!1:m.children}}}]),angular.module("app.services",["app.gridConf"]).factory("dom",["$compile","$http",function(e,t){return{setupButtons:function(e,t){if(!_.isUndefined(t.use)){var n=e.find("input"),r=t.use.split(",");for(var i=0;i<n.length;i++)_(r).contains(n[i].className.replace("Button",""))||angular.element(n[i]).remove();e.data().html=e.html()}},getItem:function(n,r,i){t.get("partials/"+r+".html").success(function(t){i(e(t)(n))})},attrsToMeta:function(e){return $ret={},_(e).each(function(e,t){if(_.isString(e))try{$ret[t]=_(["[","{"]).contains(e.substr(0,1))?JSON.parse(e):e}catch(n){}}),$ret},compileChildPane:function(t,n){var r=_.clone(n.data().meta),i=angular.element(n.data().outer);i.data().meta=r,i=e(i)(t),n.replaceWith(i)},convertChild:function(e){var t={},n=e.get()[0];for(var r=0;r<n.attributes.length;r++){var i=n.attributes[r].nodeName,s=n.attributes[r].nodeValue;i!=="class"&&i.indexOf("-")>-1&&(i=UT.camelDash(i));try{t[i]=_(["[","{"]).contains(s.substr(0,1))?JSON.parse(s):s}catch(o){}}e.data().outer='<div cms-pane row-id="{{rowId}}" parent-list="list" expose="exposing(data)" key="'+t.key+'" rel="'+t.rel+'">'+n.innerHTML+"</div>",e.data().meta=t,n.innerHTML="";return},paramTransclude:function(e,t){var n=_.isUndefined(e.data().meta)?{}:e.data().meta;return n.children=e.get()[0].innerHTML,e.html(""),_.extend(n,this.attrsToMeta(t))},makeMain:function(t){$scope=t.data().$scope,t.append(e($scope.meta.children)($scope))}}}]).factory("jquery_ui",["$http","config",function(e,t){return{setUp:function(e){if(!_.isUndefined(e.meta.jqueryUi)){var t=_.isObject(e.meta.jqueryUi)?e.meta.jqueryUi:JSON.parse(e.meta.jqueryUi);e.sortable=_(t).has("sortable")?"sortable":!1}},mkSortable:function(e,t,n){if(!_.isUndefined(e.meta.jqueryUi)){var r=_.isObject(e.meta.jqueryUi)?e.meta.jqueryUi:JSON.parse(e.meta.jqueryUi),i={tolerance:"pointer",helper:"clone",cursor:"move",distance:1,cursorAt:{left:5},update:_.isFunction(n)?n:function(){}};_.isEmpty(r.sortable)||(i=_.extend(i,{connectWith:r.sortable})),$(t).find(".sortable").sortable(i)}}}}]).factory("lData",["$http","config",function(e,t){return{prefix:"GRID:",useLocal:document.location.host==="cms",clear:function(){var e="";for(var t in localStorage)t.substr(0,5)==this.prefix&&(e+=t.substr(5)+"\n");var n=prompt("Enter key from the list:\n\n"+e);_.isEmpty(n)?localStorage.clear():delete localStorage[this.prefix+n]},save:function(e,t,n,r){if(_.isUndefined(r)||!r)e=UT.gridKey(e);if(_.isEmpty(t))return!1;var i=e.replace("/","_"),s=i.indexOf("_")>-1?"&rel":"",o=_.isUndefined(t[n])?"del":"post";return $.post("data/db.php?action="+o+"&table="+i+s+"&rowId="+n,t[n]).success(function(e){}),"success"},get:function(e,t){t.listW=angular.copy(t.list=this.getData(e.key))},getData:function(t,n){var i=t.replace("/","_"),s=i.indexOf("_")>-1?"&rel":"";e.get("data/db.php?action=get&table="+i+s).success(function(e){_.isEmpty(e)&&(e={}),n(e)}).error(function(e){LGE("GET DATA ERROR FOR "+e,t)})}}}]),angular.module("app.customDirectives",["app.gridConf"]).directive("details",["$compile","lData","config",function(t,n,r){return{restrict:"A",replace:!0,transclude:!0,templateUrl:r.tplUrls.sub,scope:!0,compile:function(e,t){return function(e,t,n){e.detailShow=!0,e.getType=function(t){return e.meta.all[t].type}}},controller:function(e,t){e.metaType="all",e.sav=function(){e.close(),e.$parent.sav()},e.close=function(){t.remove(),e.$parent.$parent.tableHide=!1}}}}]).directive("cmsUser",["config",function(e){return{restrict:"A",replace:!0,transclude:!0,templateUrl:"partials/cmsUser.html"}}]).directive("divImg",["config",function(e){return{restrict:"A",replace:!0,transclude:!0,templateUrl:"partials/divImg.html"}}]).directive("cmsCaption",["config",function(e){return{restrict:"A",replace:!0,transclude:!0,template:"<div ng-click='clk()'>{{row[meta.cols[0][0]]}}:{{row[meta.cols[1][0]]}}</div>"}}]).directive("cmsImg",["config",function(e){return{restrict:"A",replace:!0,transclude:!0,template:"<div ng-click='clk()'><img ng-src='{{row[meta.cols[1][0]]}}' width=20 height=20></img></div>"}}]).directive("aCaption",["config",function(e){return{restrict:"A",replace:!0,transclude:!0,template:"<div ng-click='clk()'>{{row[meta.cols[0][0]]}}:{{row[meta.cols[1][0]]}}></div>"}}]),angular.module("app.relations",["app.gridConf"]).service("linkers",["$http","config","$compile","lData","jquery_ui",function(e,t,n,r,i){"use strict";return{set:function(e,t,n){this[e]["default"](t,n);var r=t.meta.rel;!_.isUndefined(r)&&_.isFunction(this[e][r])&&this[e][r](t,n)},main:{"m-a":function(e,t){e.saveRelData=function(){e.relDataKey=e.expose({data:"meta"}).key+"/"+e.rowId+"/"+e.meta.key,r.save(e.relDataKey,e.relData,e.rowId)}},"m-p-out":function(e,t){e.updateList=function(){e.list={};if(!_.isEmpty(e.rowId)){var t=e.expose({data:"relData"})[e.rowId];if(!_.isUndefined(t)&&!_.isEmpty(t)){var n={};for(var r in t)n[t[r].ord]=e.parentList[r],_.isUndefined(n[t[r].ord])?delete t[r]:n[t[r].ord].id=r;setTimeout(function(){e.list=n,e.$digest()},0)}else t={}}},e.setData=function(){},e.$on("relDataChanged",e.updateList),e.$watch("rowId",e.updateList),e.handleSort=function(t){var n=$(t.target).find(".row"),r=e.expose({data:"relData"})[e.rowId];for(var i=0;i<n.length;i++)r[$(n[i]).attr("ord-id")].ord=i;e.expose({data:"saveRelData"})()};var n=e.$watch("list",function(){setTimeout(function(){i.mkSortable(e,t,e.handleSort)},800),n()})},"m-p":function(e,t){e.saveRelData=function(){_.isEmpty(e.relData[e.rowId])&&(e.relData[e.rowId]={}),r.save(e.relDataKey,e.relData,e.rowId)},e.listFilter=function(t){return _.isUndefined(e.relData)||_.isEmpty(e.rowId)?t:_.isUndefined(e.relData[e.rowId])?t:$ret=_(t).omit(_(e.relData[e.rowId]).keys())},e.relDataKey=e.expose({data:"meta"}).key+"/"+e.meta.key,r.getData(e.relDataKey,function(t){e.allRelData=_.isString(t)?json_parse(t):t,e.relData=_.isEmpty(t)?{}:t});var n=e.setData;e.setData=function(t){n(t),e.fullList=angular.copy(e.list)},setTimeout(function(){i.mkSortable(e,t,e.handleSort)},800)},"1-m":function(e,t){_.isUndefined(e.meta.selected)||setTimeout(function(){e.$broadcast("init",e.meta.selected)},1e3)}},row:{"1-m":function(e,t){},"m-p":function(e){e.buttonsOnOff("edit,del,add,out","save,sub,close")},"m-p-out":function(e){e.buttonsOnOff("remove","")}}}}]).service("controllers",["$http","config","$compile","lData",function(e,t,n,r){"use strict";return{set:function(e,t,n){this[e]["default"](t),this.defaultScope=_.clone(t),_.isFunction(this[e][t.meta.rel])&&this[e][t.meta.rel](t,n)},head:{"default":function(e){e.showContent=function(){e.hideContent=e.hideContent?!1:"hidden"},e.reload=function(){e.list=UT.dobuleCopy(e.list,e.listW),e.notify("rel","success",_.isEmpty(e.list)?" (empty)":""),e.hideContent&&e.toggleTable()}}},main:{"default":function(e){e.closeLastRow=function(t){var n=!0;return e.lastRowScope===!1?n=!1:e.lastRowScope!==null&&(e.lastRowScope.$id!==t.$id?e.lastRowScope.blr():n=!1),e.lastRowScope=t,n},e.save=function(t,n){e.list[n]=_.clone(t);var i=r.save(e.meta.key,e.list,n);_.isFunction(e.notify)&&e.notify("sav",i),e.meta.autoAdd&&e.add()},e.del=function(t){var n=_(e.list[t]).values().pop();delete e.list[t];var i=r.save(e.meta.key,e.list,t);_.isFunction(e.notify)&&e.notify("del",i,' <b>"'+n+'"</b>')},e.add=function(){var t=UT.minIntKey(e.list,-1);e.list[t]={},e.listW[t]={};for(var n=0;n<e.meta.cols.length;n++)e.list[t][e.meta.cols[n][0]]="",e.listW[t][e.meta.cols[n][0]]="";e.closeLastRow(!1),e.hideContent=!1},e.openSub=function(t){e.hideContent=e.meta.autoHide,e.rowContent="{"+t+"}"},e.subPane=function(n,r){_(t.getChildren(e.meta.key)).each(function(t,r){e.after('<div grid key="'+e.meta.key+"/"+n.id+"/"+r+'" '+'expose="exposing(data)" parentList="list" ></div>',n)}),e.openSub(r)},e.edit=function(t,n){e.closeLastRow(t),e.after('<div edit key="'+e.meta.key+"/"+t.id+'/"></div>',t),e.openSub(n)}},"m-p":function(e){var t=e.save;e.save=function(e,n){t(e,n)},e.remove=function(t){delete e.relData[e.rowId][t],e.saveRelData()}}},row:{"1-m":function(e){e.$on("init",function(t,n){_.isEmpty(n)?e.id===_.keys(e.list)[0]&&(e.clk(),e.$parent.$digest()):_.isUndefined(e.id)||e.list[e.id][e.meta.cols[0][0]]===n&&(e.clk(),e.$parent.$digest())});var t=e.clk;e.clk=function(){e.$parent.rowId=e.id,e.attachAfterRow(),t()}},"m-p":function(e){function t(){if(e.rowClass.indexOf("editable")===-1){if(!_.contains(e.relData[e.rowId],e.id)){var t=e.relData[e.rowId];_.isUndefined(t)&&(e.relData[e.rowId]=t={});var n=0;for(var r in t)t[r].ord>=n&&(n=parseInt(t[r].ord)+1);_.isUndefined(t[e.id])&&(e.relData[e.rowId][e.id]={ord:n})}e.saveRelData(),e.$parent.$broadcast("relDataChanged")}}function n(){if(e.relData)for(var t in e.relData)_.has(e.relData[t],e.id)||(e.relData[t]=_(e.relData[t]).omit(e.id))}e.dblClk=function(){t()},e.out=function(){t()};var r=e.del;e.del=function(){n(),e.saveRelData(),e.$parent.$broadcast("relDataChanged"),r()};var i=e.save;e.save=function(){n(),i(),e.$parent.$broadcast("relDataChanged")},e.clk=function(){angular.element("detail").html("").show(),angular.element("detail").append('<div class="box"><input type="button" onclick="$(this).parent().html(\'\').hide();" style="position:relative; margin:12px 12px 0 12px; float:right;" value="close"></input><div style="margin:12px 12px 0 12px;">'+e.workRow.left+"</div>"+'<img src="'+e.workRow.right+'"></img>'+"</div>")}},"m-p-out":function(e,t){e.remove=function(){e.expose({data:"remove"})(e.list[e.id].id),e.updateList()},e.clk=function(){angular.element("detail").html("").show(),angular.element("detail").append('<div class="box"><input type="button" onclick="$(this).parent().html(\'\').hide();" style="position:relative; margin:12px 12px 0 12px; float:right;" value="close"></input><div style="margin:12px 12px 0 12px;">'+e.workRow.left+"</div>"+'<img src="'+e.workRow.right+'"></img>'+"</div>")}}}}}]),angular.module("app.scopes",["app.gridConf","app.relations"]).service("linkers",["$http","config","$compile","lData","jquery_ui",function(e,t,n,r,i){"use strict";return{set:function(e,t,n){this[e]["default"](t,n);var r=t.meta.rel;!_.isUndefined(r)&&_.isFunction(this[e][r])&&this[e][r](t,n)},main:{"m-a":function(e,t){e.saveRelData=function(){e.relDataKey=e.expose({data:"meta"}).key+"/"+e.rowId+"/"+e.meta.key,r.save(e.relDataKey,e.relData,e.rowId)}},"m-p-out":function(e,t){e.updateList=function(){e.list={};if(!_.isEmpty(e.rowId)){var t=e.expose({data:"relData"})[e.rowId];if(!_.isUndefined(t)&&!_.isEmpty(t)){var n={};for(var r in t)n[t[r].ord]=e.parentList[r],_.isUndefined(n[t[r].ord])?delete t[r]:n[t[r].ord].id=r;setTimeout(function(){e.list=n,e.$digest()},0)}else t={}}},e.setData=function(){},e.$on("relDataChanged",e.updateList),e.$watch("rowId",e.updateList),e.handleSort=function(t){var n=$(t.target).find(".row"),r=e.expose({data:"relData"})[e.rowId];for(var i=0;i<n.length;i++)r[$(n[i]).attr("ord-id")].ord=i;e.expose({data:"saveRelData"})()};var n=e.$watch("list",function(){setTimeout(function(){i.mkSortable(e,t,e.handleSort)},800),n()})},"m-p":function(e,t){e.saveRelData=function(){_.isEmpty(e.relData[e.rowId])&&(e.relData[e.rowId]={}),r.save(e.relDataKey,e.relData,e.rowId)},e.listFilter=function(t){return _.isUndefined(e.relData)||_.isEmpty(e.rowId)?t:_.isUndefined(e.relData[e.rowId])?t:$ret=_(t).omit(_(e.relData[e.rowId]).keys())},e.relDataKey=e.expose({data:"meta"}).key+"/"+e.meta.key,r.getData(e.relDataKey,function(t){e.allRelData=_.isString(t)?json_parse(t):t,e.relData=_.isEmpty(t)?{}:t});var n=e.setData;e.setData=function(t){n(t),e.fullList=angular.copy(e.list)},setTimeout(function(){i.mkSortable(e,t,e.handleSort)},800)},"1-m":function(e,t){_.isUndefined(e.meta.selected)||setTimeout(function(){e.$broadcast("init",e.meta.selected)},1e3)},"default":function(e,t){i.setUp(e),e.lastRowScope=null,e.relScope=null,e.setData=function(t){e.list=t,e.listW=angular.copy(t)},setTimeout(function(){_.isUndefined(e.meta.key)||r.getData(e.meta.key,e.setData)},0),e.handleSort=function(){LGW("Presistent sorting not implemented for this relation")},e.after=function(e,r){t.find("table").parent().children().length>2&&t.find("table").next().remove();var i=n(e)(r);t.find("table").after(i)}}},row:{"1-m":function(e,t){},"m-p":function(e){e.buttonsOnOff("edit,del,add,out","save,sub,close")},"m-p-out":function(e){e.buttonsOnOff("remove","")},"default":function(e,t){e.attachAfterRow=function(){t.parent().after(e.meta.element.find("inline").detach())},e.buttons={},e.buttonsOnOff=function(t,n){_(t.split(",")).each(function(t,n){e.buttons[t]=!0}),_(n.split(",")).each(function(t,n){e.buttons[t]=!1})},e.buttonsOnOff("edit,del","add,save,sub,close"),e.rowClass="";var n=!1;if(!_.isUndefined(e.row))for(var r=0;r<e.meta.cols.length;r++)n|=e.row[e.meta.cols[r][0]]!=="";n?e.rowClass="":e.rowClass="editable",e.workRow=angular.copy(e.row)}}}}]).service("controllers",["$http","config","$compile","lData",function(e,t,n,r){"use strict";return{defaultScope:null,set:function(e,t,n){this[e]["default"](t),this.defaultScope=_.clone(t),_.isFunction(this[e][t.meta.rel])&&this[e][t.meta.rel](t,n)},head:{"default":function(e){e.showContent=function(){e.hideContent=e.hideContent?!1:"hidden"},e.reload=function(){e.list=UT.dobuleCopy(e.list,e.listW),e.notify("rel","success",_.isEmpty(e.list)?" (empty)":""),e.hideContent&&e.toggleTable()}}},main:{"default":function(e){e.closeLastRow=function(t){var n=!0;return e.lastRowScope===!1?n=!1:e.lastRowScope!==null&&(e.lastRowScope.$id!==t.$id?e.lastRowScope.blr():n=!1),e.lastRowScope=t,n},e.save=function(t,n){e.list[n]=_.clone(t);var i=r.save(e.meta.key,e.list,n);_.isFunction(e.notify)&&e.notify("sav",i),e.meta.autoAdd&&e.add()},e.del=function(t){var n=_(e.list[t]).values().pop();delete e.list[t];var i=r.save(e.meta.key,e.list,t);_.isFunction(e.notify)&&e.notify("del",i,' <b>"'+n+'"</b>')},e.add=function(){var t=UT.minIntKey(e.list,-1);e.list[t]={},e.listW[t]={};for(var n=0;n<e.meta.cols.length;n++)e.list[t][e.meta.cols[n][0]]="",e.listW[t][e.meta.cols[n][0]]="";e.closeLastRow(!1),e.hideContent=!1},e.openSub=function(t){e.hideContent=e.meta.autoHide,e.rowContent="{"+t+"}"},e.subPane=function(n,r){_(t.getChildren(e.meta.key)).each(function(t,r){e.after('<div grid key="'+e.meta.key+"/"+n.id+"/"+r+'" '+'expose="exposing(data)" parentList="list" ></div>',n)}),e.openSub(r)},e.edit=function(t,n){e.closeLastRow(t),e.after('<div edit key="'+e.meta.key+"/"+t.id+'/"></div>',t),e.openSub(n)}},"m-p":function(e){var t=e.save;e.save=function(e,n){t(e,n)},e.remove=function(t){delete e.relData[e.rowId][t],e.saveRelData()}}},row:{"1-m":function(e){e.$on("init",function(t,n){_.isEmpty(n)?e.id===_.keys(e.list)[0]&&(e.clk(),e.$parent.$digest()):_.isUndefined(e.id)||e.list[e.id][e.meta.cols[0][0]]===n&&(e.clk(),e.$parent.$digest())});var t=e.clk;e.clk=function(){e.$parent.rowId=e.id,e.attachAfterRow(),t()}},"m-p":function(e){function t(){if(e.rowClass.indexOf("editable")===-1){if(!_.contains(e.relData[e.rowId],e.id)){var t=e.relData[e.rowId];_.isUndefined(t)&&(e.relData[e.rowId]=t={});var n=0;for(var r in t)t[r].ord>=n&&(n=parseInt(t[r].ord)+1);_.isUndefined(t[e.id])&&(e.relData[e.rowId][e.id]={ord:n})}e.saveRelData(),e.$parent.$broadcast("relDataChanged")}}function n(){if(e.relData)for(var t in e.relData)_.has(e.relData[t],e.id)||(e.relData[t]=_(e.relData[t]).omit(e.id))}e.dblClk=function(){t()},e.out=function(){t()};var r=e.del;e.del=function(){n(),e.saveRelData(),e.$parent.$broadcast("relDataChanged"),r()};var i=e.save;e.save=function(){n(),i(),e.$parent.$broadcast("relDataChanged")},e.clk=function(){angular.element("detail").html("").show(),angular.element("detail").append('<div class="box"><input type="button" onclick="$(this).parent().html(\'\').hide();" style="position:relative; margin:12px 12px 0 12px; float:right;" value="close"></input><div style="margin:12px 12px 0 12px;">'+e.workRow.left+"</div>"+'<img src="'+e.workRow.right+'"></img>'+"</div>")}},"m-p-out":function(e,t){e.remove=function(){e.expose({data:"remove"})(e.list[e.id].id),e.updateList()},e.clk=function(){angular.element("detail").html("").show(),angular.element("detail").append('<div class="box"><input type="button" onclick="$(this).parent().html(\'\').hide();" style="position:relative; margin:12px 12px 0 12px; float:right;" value="close"></input><div style="margin:12px 12px 0 12px;">'+e.workRow.left+"</div>"+'<img src="'+e.workRow.right+'"></img>'+"</div>")}},"default":function(e){function t(){return e.buttons.save=e.dirty=!_(e.row).isEqual(e.workRow)}function n(){return UT.join(_(e.workRow).filter(function(t,n){if(!_.isUndefined(e.meta.tab[n]))return e.meta.tab[n].type==="T"?t:!1}))}e.hover=function(){},e.getElementClass=function(t){return e.meta.tab[t].type==="T"?"":"notext"},e.chg=function(){e.rowClass="editable"+(t()?" dirty":"")},e.sel=function(){e.rowClass="selected"+(t()?" dirty":"")},e.blr=function(){e.rowClass?e.rowClass=e.rowClass.replace("editable","").replace("selected",""):e.rowClass="",e.buttonsOnOff("edit","save,close")},e.editRow=function(){e.closeLastRow(e),e.chg()},e.defaultClk=function(e){},e.clk=function(t,n){e.closeLastRow(e)&&e.sel()},e.save=function(){e.$parent.save(e.workRow,e.id),e.rowClass="",e.buttonsOnOff("edit","close,save")},e.del=function(){e.$parent.del(e.id)},e.subPane=function(){e.$parent.subPane(e,n())},e.edit=function(){e.chg(),e.closeLastRow(e),e.buttonsOnOff("close","edit")},e.close=function(){e.workRow=_.clone(e.row),e.blr()}}}}}]);var myApp=angular.module("app",["app.services","app.directives","app.customDirectives"]);contentPane.$inject=["$scope","lData"],myApp.controller("contentPane",contentPane);